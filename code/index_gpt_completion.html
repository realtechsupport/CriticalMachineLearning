<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>PyScript + OpenAI</title>	
	<link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
	<script defer src="https://pyscript.net/latest/pyscript.js"></script>
</head>
<body>
<div id="prompt"></div>
<div id="completion"></div>

<py-script>
	import json
	from js import localStorage, document, console, XMLHttpRequest

	# set the API key - various approaches
	api_key = "XXX"
	bearer = "Bearer " + api_key

	promptDiv = document.getElementById("prompt")
	prompt = "Describe the most common reaasons for car accidents, please."	
	promptDiv.innerHTML = "<h3>Prompt: </h3>\"" + prompt + "\"<hr/>"

	engine = "text-ada-001"

	# references
	# https://platform.openai.com/docs/api-reference/images/create
	# https://platform.openai.com/docs/guides/completion/introduction
	# https://platform.openai.com/docs/guides/chat

	# build the request
	xhr = XMLHttpRequest.new()
	xhr.open("POST", "https://api.openai.com/v1/completions", False)
	xhr.setRequestHeader("Content-Type", "application/json")
	xhr.setRequestHeader("Authorization", bearer)
	
	# define the elements of the data request
	data = json.dumps({
	"model": engine,
	"prompt": prompt,
	"max_tokens": 500,
	"temperature": 0,
	"top_p": 1,
	"frequency_penalty": 1.2,
	"presence_penalty": 0
	})

	#send the request
	xhr.send(data)

	#get the text from the request
	json_response = json.loads(xhr.response)
	completion_text = json_response["choices"][0]["text"]
	completionDiv = document.getElementById("completion")
	completionDiv.innerHTML = "<h3>OpenAI (" + engine + ") response: </h3>\"" + completion_text.strip() + "\""
</py-script>
</body>
</html>




